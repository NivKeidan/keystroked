---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import FeaturedPost from "../components/FeaturedPost";
import PostCard from "../components/PostCard";
import NewsletterSubscribe from "../components/NewsletterSubscribe";

const sortedPosts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// First post is featured, all posts are recent
const featuredPostData = sortedPosts[0];
const recentPostsData = sortedPosts;

// Format featured post
const featuredPost = featuredPostData
	? {
			slug: featuredPostData.id,
			title: featuredPostData.data.title,
			excerpt: featuredPostData.data.excerpt,
			date: featuredPostData.data.pubDate.toLocaleDateString("en-US", {
				month: "short",
				day: "numeric",
				year: "numeric",
			}),
			readTime: featuredPostData.data.readTime,
			thumbnail: featuredPostData.data.thumbnail,
			tags: featuredPostData.data.tags,
		}
	: null;

// Format recent posts
const recentPosts = recentPostsData.map((post) => ({
	slug: post.id,
	title: post.data.title,
	excerpt: post.data.excerpt,
	date: post.data.pubDate.toLocaleDateString("en-US", {
		month: "short",
		day: "numeric",
		year: "numeric",
	}),
	readTime: post.data.readTime,
	thumbnail: post.data.thumbnail,
	tags: post.data.tags,
}));
---

<BaseLayout title="Keystroked">
	<main class="container mx-auto px-6 py-12 2xl:w-[1400px]">
		{/* Hero Section */}
		<section class="mb-16 fade-in">
			<div class="max-w-2xl">
				<h1
					class="text-4xl md:text-5xl font-mono font-bold text-foreground mb-4"
				>
					Thoughts on{" "}
					<span class="text-primary text-glow-green">coders</span>,{
						" "
					}<br />
					<span class="text-terminal-amber text-glow-amber"
						>development</span
					>, and building things that last.
				</h1>
				<p class="text-lg text-muted-foreground leading-relaxed">
					A personal collection of technical deep-dives, thoughts on
					leadership, and lessons learned while creating things on the
					internet.
				</p>
				<p
					class="text-xl font-semibold text-foreground font-mono mt-10"
				>
					keystroked, <span
						class="text-terminal-amber text-glow-amber"
						>not just generated.</span
					>
				</p>
			</div>
		</section>

		{/* Featured Post Section */}
		<section class="mb-16">
			<div class="flex items-center gap-3 mb-6">
				<span class="font-mono text-sm text-forest">~/featured</span>
				<div class="flex-1 h-px bg-forest"></div>
			</div>
			{featuredPost && <FeaturedPost {...featuredPost} />}
		</section>

		{/* Recent Posts Grid */}
		<section>
			<div class="flex items-center gap-3 mb-8">
				<span class="font-mono text-sm text-forest">~/recent</span>
				<div class="flex-1 h-px bg-forest"></div>
			</div>

			<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
				{
					recentPosts.map((post, index) => (
						<PostCard {...post} delay={index + 1} />
					))
				}
			</div>
		</section>

		{/* Newsletter CTA */}
		<NewsletterSubscribe client:load />
	</main>
</BaseLayout>
