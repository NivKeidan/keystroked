---
import { getCollection } from 'astro:content';
import BaseLayout from "../layouts/BaseLayout.astro";
import FeaturedPost from "../components/FeaturedPost";
import PostCard from "../components/PostCard";

const sortedPosts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// First post is featured, all posts are recent
const featuredPostData = sortedPosts[0];
const recentPostsData = sortedPosts;

// Format featured post
const featuredPost = featuredPostData ? {
  slug: featuredPostData.id,
  title: featuredPostData.data.title,
  excerpt: featuredPostData.data.excerpt,
  date: featuredPostData.data.pubDate.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    year: 'numeric' 
  }),
  readTime: featuredPostData.data.readTime,
  thumbnail: featuredPostData.data.thumbnail,
  tags: featuredPostData.data.tags,
} : null;

// Format recent posts
const recentPosts = recentPostsData.map(post => ({
  slug: post.id,
  title: post.data.title,
  excerpt: post.data.excerpt,
  date: post.data.pubDate.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    year: 'numeric' 
  }),
  readTime: post.data.readTime,
  thumbnail: post.data.thumbnail,
  tags: post.data.tags,
}));
---

<BaseLayout title="Keystroked">
	<main class="container mx-auto px-6 py-12 2xl:w-[1400px]">
	{/* Hero Section */}
	<section class="mb-16 fade-in">
		<div class="max-w-2xl">
		<h1 class="text-4xl md:text-5xl font-mono font-bold text-foreground mb-4">
			Thoughts on{" "}
			<span class="text-primary text-glow-green">coders</span>,{" "}<br>
			<span class="text-terminal-amber text-glow-amber">development</span>, and building things that last.
		</h1>
		<p class="text-lg text-muted-foreground leading-relaxed">
			A personal collection of technical deep-dives, thoughts on leadership, 
			and lessons learned while creating things on the internet.
		</p>
		<p class="text-xl font-semibold text-foreground font-mono mt-10">
			keystroked, <span class="text-terminal-amber text-glow-amber">not just generated.</span>
		</p>
		</div>
	</section>

	{/* Featured Post Section */}
	<section class="mb-16">
		<div class="flex items-center gap-3 mb-6">
		<span class="font-mono text-sm text-forest">~/featured</span>
		<div class="flex-1 h-px bg-forest" />
		</div>
		{featuredPost && <FeaturedPost {...featuredPost} />}
	</section>

	{/* Recent Posts Grid */}
	<section>
		<div class="flex items-center gap-3 mb-8">
		<span class="font-mono text-sm text-forest">~/recent</span>
		<div class="flex-1 h-px bg-forest" />
		</div>

		<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
		{recentPosts.map((post, index) => (
			<PostCard {...post} delay={index + 1} />
		))}
		</div>
	</section>

	{/* Newsletter CTA */}
	<section class="mt-20 fade-in" style={{ animationDelay: "0.8s" }}>
		<div class="terminal-box p-8 md:p-12 text-center">
		<h2 class="text-2xl font-mono font-semibold text-foreground mb-3">
			$ subscribe --newsletter
		</h2>
		<p class="text-muted-foreground mb-6 max-w-md mx-auto">
			Get notified when I publish something new. No spam, just quality
			content delivered to your inbox.
		</p>
		<div class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
			<input
			type="email"
			placeholder="you@email.com"
			class="flex-1 px-4 py-3 bg-secondary border border-border rounded-lg font-mono text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"
			/>
			<button id="subscribe-btn" class="px-6 py-3 bg-forest text-white font-mono text-sm font-medium rounded-lg hover:bg-forest/90 transition-colors">
			Subscribe
			</button>
		</div>
		<script>
			document.getElementById("subscribe-btn")?.addEventListener("click", () => {
				if (typeof window !== 'undefined' && window.gtag) {
					window.gtag("event", "subscribe_click", {
						location: "homepage",
					});
				}
			});
		</script>
		</div>
	</section>
	</main>
</BaseLayout>
